<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: hooks/userAction.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: hooks/userAction.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { UserContext } from "../contexts/UserContext";
import conectar from "../helpers/fetch"
import { useContext, useState } from "react"

const urlbase = import.meta.env.VITE_BACKEND_URL

/**
 * Hook personalizado para gestionar acciones de usuario relacionadas con contenidos externos y favoritos.
 * * Este hook centraliza la lógica de:
 * 1. Traducción de textos mediante DeepL (vía backend).
 * 2. Búsqueda de recetas en la API externa de Spoonacular.
 * 3. Gestión de favoritos (añadir/eliminar).
 * 4. Persistencia de recetas externas en la base de datos local.
 * * @kind function
 * @returns {Object} Métodos y estados para la gestión de contenido.
 */
export const UserAction = () => {

  const [translation, setTranslation] = useState("");
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState(null);
  const { user, token, urlBase} = useContext(UserContext)

  /**
   * traducir
   * Llama a la API de DeepL para traducir un texto
   *
   * @param {string} text - Texto a traducir
   * @param {string} source - Código del idioma fuente (ES, EN, etc.)
   * @param {string} target - Código del idioma destino (EN, ES, etc.)
   */
  const traducir = async (texto, source = "ES", target = "EN") => {
    if (!texto) return;
    console.log('hola desde traducir, este es el texto: ', texto)
    const body = {
      text: texto,
      source: source,
      target: target,
    }
//  console.log(body)
    setLoading(true);
    setError(null);

    try {
      const resp = await conectar(`${urlbase}/user/traducir`, 'POST', body, token )
    //   const data = await resp.json();
      console.log({resp})
      return resp.data.translations[0].text
    } catch (error) {
      setError(error.message);
      setTranslation("");
    } finally {
      setLoading(false);
    }
}

/**
     * Realiza una consulta directa a la API de Spoonacular.
     * @async
     * @param {string} query - Endpoint y parámetros de búsqueda (ej. /search?query=pasta).
     * @returns {Promise&lt;Object>} Datos devueltos por la API de Spoonacular.
     */
const spooncular = async (query) => {
    try {
        
        const resp = await conectar(`https://api.spoonacular.com/recipes${query}`)
        return resp
    } catch (error) {
        console.log(error, 'Error al buscar recetas')
    }
}

/**
     * Guarda un artículo o receta en la lista de favoritos del usuario.
     * @async
     * @param {number|string|null} idAticulo - ID del artículo (si aplica).
     * @param {number|string|null} idReceta - ID de la receta (si aplica).
     * @returns {Promise&lt;Object>} Respuesta del servidor.
     */
   const guardarEnFavoritos = async(idAticulo, idReceta)=> {
        try {
            const resp = await conectar(
                `${urlBase}/user/anadirFavoritos`,
                'POST',
                { id_articulo: idAticulo, id_receta: idReceta }, //enviamos el body
                token
            );

            console.log('Guardado en favoritos:', resp);
            return resp;

        } catch (error) {
            console.error('Error al guardar favorito:', error.message);
            return error;
        }
     };

     /**
     * Elimina un elemento de favoritos detectando automáticamente si es artículo o receta.
     * @async
     * @param {number|string|null} id_articulo - ID del artículo.
     * @param {number|string|null} id_receta - ID de la receta.
     * @returns {Promise&lt;Object>} Respuesta del servidor tras la eliminación.
     */
    const eliminarDeFavoritos = async(id_articulo, id_receta) => {
        const id = id_articulo ? id_articulo : id_receta 
        const tipo = id_articulo ? 'articulo' : 'receta'
        // console.log(id, tipo)
        try {
            const resp = await conectar(
               `${urlBase}/user/deleteFavorito/${id}/${tipo}`,
                'DELETE',
                null,
                token 
            )
            return resp
            // console.log('Eliminado de favoritos',  resp)
        } catch (error) {
            console.log(error, 'Ha habido un error al eliminar favoritos')
            return error
        }

    }
    
    /**
     * Obtiene una receta externa, la traduce al español y la guarda en la base de datos local.
     * * Este método combina la API de Spoonacular, el servicio de traducción y el backend propio.
     * @async
     * @param {number|string} id - ID de la receta en Spoonacular.
     */
    const guardarRecetaEnBd = async(id) => {
        if(!id) return
        try{
            const resp = await spooncular(`/${id}/information`)
            console.log(resp, 'desde el hook guardar')
            const titulo = await traducir(resp.title, "EN", "ES")
            const contenido = await traducir(resp.instructions, "EN", "ES")
            const receta = { 
                                id_receta: id,
                                titulo,
                                imagen_url: resp.image,
                                contenido
                            }
            await conectar(`${urlBase}/user/anadirReceta`,
                'POST',
                receta,
                token
            )
            
        }
        catch(error){
            console.log(error)
        }
    }

    return {
        traducir,
        translation,
        loading,
        error,
        spooncular,
        eliminarDeFavoritos,
        guardarEnFavoritos,
        guardarRecetaEnBd
    }
}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#AdminBuscar">AdminBuscar</a></li><li><a href="global.html#AdminCrear">AdminCrear</a></li><li><a href="global.html#AdminCrearUsuario">AdminCrearUsuario</a></li><li><a href="global.html#AdminEditar">AdminEditar</a></li><li><a href="global.html#AdminEditarUsuario">AdminEditarUsuario</a></li><li><a href="global.html#App">App</a></li><li><a href="global.html#AppRoutes">AppRoutes</a></li><li><a href="global.html#ArtculosHome">ArtculosHome</a></li><li><a href="global.html#ArticuloDetalle">ArticuloDetalle</a></li><li><a href="global.html#AuthLayout">AuthLayout</a></li><li><a href="global.html#BuscarArticulo">BuscarArticulo</a></li><li><a href="global.html#Card">Card</a></li><li><a href="global.html#Errores">Errores</a></li><li><a href="global.html#Favoritos">Favoritos</a></li><li><a href="global.html#GaleriaArticulos">GaleriaArticulos</a></li><li><a href="global.html#GaleriaUsuarios">GaleriaUsuarios</a></li><li><a href="global.html#Header">Header</a></li><li><a href="global.html#HomePage">HomePage</a></li><li><a href="global.html#Layout">Layout</a></li><li><a href="global.html#LoginPage">LoginPage</a></li><li><a href="global.html#MostrarArticulos">MostrarArticulos</a></li><li><a href="global.html#MostrarUsuarios">MostrarUsuarios</a></li><li><a href="global.html#Proteccion">Proteccion</a></li><li><a href="global.html#RecetaDetalle">RecetaDetalle</a></li><li><a href="global.html#RecetasFavoritas">RecetasFavoritas</a></li><li><a href="global.html#RecetasHome">RecetasHome</a></li><li><a href="global.html#RegisterPage">RegisterPage</a></li><li><a href="global.html#TarjetaArticulo">TarjetaArticulo</a></li><li><a href="global.html#UserAction">UserAction</a></li><li><a href="global.html#UserBuscarRecetas">UserBuscarRecetas</a></li><li><a href="global.html#UserProvider">UserProvider</a></li><li><a href="global.html#adminActions">adminActions</a></li><li><a href="global.html#conectar">conectar</a></li><li><a href="global.html#handleSubmit">handleSubmit</a></li><li><a href="global.html#userAuth">userAuth</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.5</a> on Tue Jan 13 2026 22:38:57 GMT+0100 (hora estándar de Europa central)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
